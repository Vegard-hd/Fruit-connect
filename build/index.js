$(async function(){$("#startGame").on("click",async function(z){await gsap.to(".buttonWrapper",{scale:1.1,duration:0.1,ease:"elastic.out(2, 0.3)"}).then(()=>{$(".buttonWrapper").remove(),$(".parentContainer").toggleClass("d-none")}).catch((E)=>{console.warn("failed to start game")})});let P=io(),U;P.on("initial-data",async(z)=>{if(U===!0)return;await Z(z),U=!0}),P.on("message",async(z)=>{if(z?.gameEnded)window.location="/completed";else await Y(z.result),_(z.score)}),P.on("error",(z)=>{console.error("Socket error:",z)});function X(z){P.emit("message",z)}async function Y(z){return await await new Promise((J,V)=>{JSON.parse(z).map((A)=>{return{row:Math.floor(A.index/10),index:A.index,col:A.index%10,newFruit:A.newFruit}}).forEach(async(A)=>{let H=A.row+1,R=[...$(`#row${H}`).children()].find((W,q)=>q===A.col);await gsap.to(R,{opacity:0,scale:2.5,duration:0.1,ease:"elastic.out(2, 0.3)"}).then(()=>$(R).remove()).then(()=>{$(`#row${H}`).prepend(`<img id="${A.newFruit.id}" src="${A.newFruit.src}" alt="${A.newFruit.fruit}" />`)});var L=gsap.timeline({});let N=`#${A.newFruit.id}`;L.to(N,{scale:1.6,duration:0.1}),L.to(N,{scale:0.8,duration:0.1}),L.to(N,{scale:1,duration:0.1,ease:"elastic.out(2,0.3)"})}),J("success")})}async function Z(z){return await new Promise(async(J,V)=>{try{let K=await JSON.parse(z),Q=0,A=1;K.forEach((H,R)=>{let{fruit:L,src:N,id:W}=H;if(Q++,$(`#row${A}`).append(`<img id="${W}" src="${N}" alt="${L}" />`),Q>=10)Q=0,A++}),setTimeout(()=>{J()},1000)}catch(K){console.error(K),V(K)}})}function _(z=1){$("#gameScore").text(z)}$(document).on("click",async function(z){try{if(z.target.tagName==="IMG"){let E=await $(z.target)[0].id;if(!E)return;let J=JSON.stringify({fruit:E});X(J)}}catch(E){console.warn(E)}})});
